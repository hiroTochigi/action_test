name: Separate Audio

on:
  workflow_dispatch:
    inputs:

jobs:
  diagrams:
    name: Separate Audio
    runs-on: ubuntu-latest

    strategy:
      matrix:
        directory: [1, 2, 3]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      
      - name: Set up Python Environment
        uses: actions/setup-python@v2
        with:
          python-version: '3.8' # Version range or exact version of a Python version to use, using SemVer's version range syntax
          architecture: 'x64' # optional x64 or x86. Defaults to x64 if not specified

      - name: Start Script
        run: |
          cd analyze_video
          mkdir -p audio/input
          mkdir -p audio/output
          mkdir -p transcript
          mkdir -p plot
          mkdir -p model
          touch audio/output/{{ matrix.directory }}.txt
          ls audio/output/
          #echo "download audio data"
          #wget -q https://ondemand.npr.org/anon.npr-mp3/npr/fa/2021/07/20210723_fa_01.mp3 -P audio/input/
          #ls audio/input/
          #echo "download model.pbmm"
          #wget -q https://github.com/mozilla/DeepSpeech/releases/download/v0.9.3/deepspeech-0.9.3-models.pbmm -P model/
          #ls model/
          #echo "download model.scorer"
          #wget -q https://github.com/mozilla/DeepSpeech/releases/download/v0.9.3/deepspeech-0.9.3-models.scorer -P model/
          #ls model/
          #docker run --name separate_audio -v `pwd`:/analyze hirotochigi/separate_audio python analyze/src/separate_audio.py
          #docker run --name transcript_audio -v `pwd`:/analyze hirotochigi/deepspeech python analyze/src/transcript.py

          # bash docker/start_separate_container.sh
          # python separate_audio.py
          
      - name: Upload Result
        uses: actions/upload-artifact@v2
        with:
          name: result
          path: analyze/audio/output/*
          #path: analyze_video/transcript/*